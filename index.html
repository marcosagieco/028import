<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üöÄ Esquiva Turbo (Hardcore)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #3b82f6; --bg: #0f172a; --text: #f1f5f9; --game-bg: #1e293b; --player: #22c55e; --enemy: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; justify-content: center; overflow-x: hidden; touch-action: manipulation; }
        
        /* Contenedor principal */
        .container { max-width: 600px; width: 100%; padding: 20px; box-sizing: border-box; }

        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 15px; }
        h1 { margin: 0; font-size: 1.2em; }
        .user-info { font-size: 0.85em; color: #94a3b8; margin-right: 10px; }

        /* AREA DE JUEGO (CANVAS) */
        .game-wrapper { position: relative; width: 100%; text-align: center; }
        canvas { 
            background: var(--game-bg); 
            border-radius: 8px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            display: block; 
            margin: 0 auto;
            max-width: 100%;
            cursor: pointer;
        }

        /* UI SOBRE EL JUEGO */
        #startScreen, #gameOverScreen {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 8px;
            z-index: 10;
        }
        
        .score-display { font-size: 4em; font-weight: bold; color: var(--primary); margin: 10px 0; text-shadow: 0 0 20px rgba(59, 130, 246, 0.6); }
        .instructions { color: #cbd5e1; margin-bottom: 20px; font-size: 0.9em; padding: 0 20px; }
        .speed-indicator { color: #ef4444; font-weight: bold; font-size: 0.8em; margin-top: 5px; text-transform: uppercase; letter-spacing: 2px; }

        /* Botones */
        button { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; font-size: 1em; cursor: pointer; transition: transform 0.1s; }
        button:active { transform: scale(0.95); }
        button.logout { background: #334155; padding: 5px 12px; font-size: 0.8em; margin-left: 10px; }

        /* Controles M√≥viles (Visuales) */
        .mobile-controls { display: flex; justify-content: space-between; margin-top: 10px; display: none; }
        .control-btn { background: #334155; width: 48%; padding: 25px; border-radius: 8px; font-size: 2em; opacity: 0.6; }
        @media (max-width: 768px) { .mobile-controls { display: flex; } }

        /* LEADERBOARD */
        .leaderboard-card { margin-top: 30px; background: #1e293b; padding: 20px; border-radius: 12px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #334155; }
        th { color: #64748b; text-transform: uppercase; font-size: 0.8em; }
        .rank-1 { color: #fbbf24; font-weight: bold; font-size: 1.1em; } 
        .rank-2 { color: #e2e8f0; font-weight: bold; }
        .rank-3 { color: #b45309; font-weight: bold; }

        /* PANTALLA DE LOGIN */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; z-index: 5000; }
        .login-box { background: white; color: #1e293b; padding: 30px; border-radius: 12px; width: 85%; max-width: 320px; text-align: center; }
        .login-box input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<!-- 1. LOGIN (Seguridad) -->
<div id="loginOverlay">
    <div class="login-box">
        <h2 style="margin-top:0;">üèéÔ∏è Acceso Turbo</h2>
        <input type="email" id="emailInput" placeholder="Correo (admin@vapes.com)">
        <input type="password" id="passInput" placeholder="Contrase√±a">
        <button onclick="login()" style="width:100%;">Arrancar Motores</button>
        <p id="loginError" style="color: red; font-size: 0.8em; margin-bottom:0;"></p>
    </div>
</div>

<!-- 2. JUEGO -->
<div class="container">
    <header>
        <div>
            <h1>üöÄ Esquiva Turbo</h1>
            <span id="currentUserDisplay" class="user-info">Cargando...</span>
        </div>
        <button onclick="logout()" class="logout">Salir</button>
    </header>

    <div class="game-wrapper">
        <canvas id="gameCanvas" width="400" height="500"></canvas>
        
        <!-- Pantalla de Inicio -->
        <div id="startScreen">
            <i class="fas fa-meteor" style="font-size: 4em; color: var(--enemy); margin-bottom: 20px;"></i>
            <h2>¬°Modo Veloz!</h2>
            <p class="instructions">La velocidad aumentar√° con CADA punto.<br>¬°Aguanta lo que puedas!</p>
            <button onclick="startGame()">Jugar Ahora</button>
        </div>

        <!-- Pantalla Game Over -->
        <div id="gameOverScreen" class="hidden">
            <h2 style="color: var(--enemy);">¬°Eliminado! üí•</h2>
            <p style="margin-bottom:0;">Tu R√©cord:</p>
            <div class="score-display" id="finalScoreDisplay">0</div>
            <div id="finalSpeedDisplay" class="speed-indicator">Velocidad M√°xima</div>
            <button onclick="startGame()" style="margin-top:20px;">Reintentar</button>
        </div>
    </div>

    <!-- Controles t√°ctiles -->
    <div class="mobile-controls">
        <button class="control-btn" ontouchstart="moveLeft()" onmousedown="moveLeft()">‚¨ÖÔ∏è</button>
        <button class="control-btn" ontouchstart="moveRight()" onmousedown="moveRight()">‚û°Ô∏è</button>
    </div>

    <!-- 3. RANKING (Nube) -->
    <div class="leaderboard-card">
        <h3 style="margin-top:0;">üèÜ Sal√≥n de la Fama (Global)</h3>
        <table>
            <thead><tr><th>#</th><th>Jugador</th><th>Puntos</th></tr></thead>
            <tbody id="leaderboardTable">
                <tr><td colspan="3">Sincronizando...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<!-- LIBRER√çAS FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
    // ==========================================
    // --- PEGA AQU√ç TU CONFIGURACI√ìN DE FIREBASE ---
    // ==========================================
    const firebaseConfig = {
  apiKey: "AIzaSyDoMATZ1yjZ3Q0ZsaFSgprs7VegxMdTifs",
  authDomain: "gestion-de-ventas-vapes.firebaseapp.com",
  databaseURL: "https://gestion-de-ventas-vapes-default-rtdb.firebaseio.com",
  projectId: "gestion-de-ventas-vapes",
  storageBucket: "gestion-de-ventas-vapes.firebasestorage.app",
  messagingSenderId: "547834087144",
  appId: "1:547834087144:web:249116f7c21dba9815ab5d",
  measurementId: "G-4YQM8PBLSM"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // --- L√≥gica de Login ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('currentUserDisplay').textContent = "Piloto: " + user.email.split('@')[0];
        } else {
            document.getElementById('loginOverlay').classList.remove('hidden');
        }
    });

    function login() {
        const email = document.getElementById('emailInput').value;
        const pass = document.getElementById('passInput').value;
        auth.signInWithEmailAndPassword(email, pass).catch(e => document.getElementById('loginError').textContent = e.message);
    }
    function logout() { auth.signOut(); }

    // ==========================================
    // --- MOTOR DEL JUEGO (MODIFICADO VELOCIDAD) ---
    // ==========================================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    function resizeCanvas() {
        const containerWidth = document.querySelector('.container').clientWidth - 40; 
        canvas.width = Math.min(400, containerWidth);
        canvas.height = 500;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Variables del Juego
    let gameRunning = false;
    let score = 0;
    let player = { x: canvas.width / 2 - 20, y: canvas.height - 60, w: 40, h: 40, color: '#22c55e', speed: 30 }; // Jugador m√°s √°gil
    let obstacles = [];
    let frameCount = 0;
    
    // CONFIGURACI√ìN DE DIFICULTAD
    let obstacleSpeed = 3; 

    // Controles de Teclado
    document.addEventListener('keydown', (e) => {
        if (!gameRunning) return;
        if (e.key === 'ArrowLeft') moveLeft();
        if (e.key === 'ArrowRight') moveRight();
    });

    // Controles T√°ctiles (Mejorados para respuesta r√°pida)
    canvas.addEventListener('touchstart', handleTouch, {passive: false});
    canvas.addEventListener('mousedown', handleTouch);

    function handleTouch(e) {
        if (!gameRunning) return;
        e.preventDefault(); 
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const x = clientX - rect.left;

        if (x < canvas.width / 2) moveLeft();
        else moveRight();
    }

    function moveLeft() {
        player.x -= player.speed;
        if (player.x < 0) player.x = 0;
    }

    function moveRight() {
        player.x += player.speed;
        if (player.x + player.w > canvas.width) player.x = canvas.width - player.w;
    }

    function startGame() {
        // Reset variables
        player.x = canvas.width / 2 - 20;
        obstacles = [];
        score = 0;
        frameCount = 0;
        obstacleSpeed = 4; // Empezamos un poco m√°s r√°pido que antes
        gameRunning = true;

        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('gameOverScreen').classList.add('hidden');
        requestAnimationFrame(gameLoop);
    }

    function gameLoop() {
        if (!gameRunning) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Dibujar Jugador
        ctx.fillStyle = player.color;
        ctx.shadowBlur = 20;
        ctx.shadowColor = player.color;
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.shadowBlur = 0;

        // 2. Generar Obst√°culos (L√≥gica m√°s dif√≠cil)
        frameCount++;
        
        // F√ìRMULA DE SPAWN: 
        // Empieza generando cada 60 frames. 
        // Baja r√°pido hasta llegar a un m√≠nimo de 15 frames (lluvia intensa).
        let spawnRate = Math.max(15, 60 - score); 
        
        if (frameCount % spawnRate === 0) {
            const size = Math.random() * 40 + 20; // Bloques de tama√±o variado
            const xPos = Math.random() * (canvas.width - size);
            obstacles.push({ x: xPos, y: -50, w: size, h: 20, color: '#ef4444' });
        }

        // 3. Mover y Colisiones
        for (let i = 0; i < obstacles.length; i++) {
            let obs = obstacles[i];
            obs.y += obstacleSpeed; // Caen a la velocidad actual

            ctx.fillStyle = obs.color;
            ctx.fillRect(obs.x, obs.y, obs.w, obs.h);

            // Choque
            if (
                player.x < obs.x + obs.w &&
                player.x + player.w > obs.x &&
                player.y < obs.y + obs.h &&
                player.h + player.y > obs.y
            ) {
                gameOver();
                return;
            }

            // Esquivado exitoso
            if (obs.y > canvas.height) {
                obstacles.splice(i, 1);
                i--;
                score++;
                
                // --- ACELERACI√ìN ---
                // Cada punto aumenta la velocidad en 0.15
                // Esto hace que en 10 puntos ya vaya un 50% m√°s r√°pido
                obstacleSpeed += 0.15;
            }
        }

        // HUD
        ctx.fillStyle = "white";
        ctx.font = "bold 24px Arial";
        ctx.fillText(score, 20, 40);
        
        // Barra de velocidad (visual)
        ctx.fillStyle = "#ef4444";
        ctx.fillRect(0, 0, (obstacleSpeed * 10), 5); // Crece con la velocidad

        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        gameRunning = false;
        document.getElementById('gameOverScreen').classList.remove('hidden');
        document.getElementById('finalScoreDisplay').textContent = score;
        document.getElementById('finalSpeedDisplay').textContent = "Velocidad Final: " + obstacleSpeed.toFixed(1) + "x";
        
        saveScore(score);
    }

    // ==========================================
    // --- CONEXI√ìN CON LA NUBE ---
    // ==========================================

    function saveScore(points) {
        const user = auth.currentUser;
        if (!user) return;
        const userName = user.email.split('@')[0];

        // Guardamos en 'turboScores' para diferenciar de la versi√≥n anterior
        db.ref('turboScores').push({
            player: userName,
            score: points,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
    }

    // Ranking Turbo
    db.ref('turboScores').orderByChild('score').limitToLast(10).on('value', (snapshot) => {
        const tableBody = document.getElementById('leaderboardTable');
        tableBody.innerHTML = '';
        
        let scores = [];
        snapshot.forEach((child) => { scores.push(child.val()); });
        scores.reverse();

        if (scores.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="3" style="text-align:center;">Sin records a√∫n</td></tr>';
            return;
        }

        scores.forEach((data, index) => {
            const row = tableBody.insertRow();
            let rankClass = '';
            if (index === 0) rankClass = 'rank-1';
            if (index === 1) rankClass = 'rank-2';
            if (index === 2) rankClass = 'rank-3';

            let icon = index === 0 ? 'üèéÔ∏è ' : (index < 3 ? 'üèÅ ' : '');

            row.innerHTML = `
                <td class="${rankClass}">${index + 1}</td>
                <td>${icon}${data.player}</td>
                <td><b>${data.score}</b></td>
            `;
        });
    });

</script>
</body>
</html>
